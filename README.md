# work_4  
Pid Center

### 背景
商品作为广告/电商/自然流量中的核心资产，获取逻辑分散在各个服务中，由不同的团队维护，寻找起来比较困难。目前，商业化缺乏一个统一的组件，打通站外商品-站内商品-商品属性。本项目即提供一个统一的Pid-Center服务，用于充分利用公司积累的数据与技术。

### 项目能力
<p align="center">
  <img src="https://github.com/user-attachments/assets/e8a9279d-bc7f-42be-835a-5637c1480078" width="50%">
</p>

项目可以构成一个图，图中有双向边和单向边。

- 对于**单向边**来说，项目提供  
  - `adId` → `pid` → 商品属性  

- 对于**双向边**来说，项目提供  
  - 站内商品 ⇄ 站外商品 ⇄ 商品蔟的互相映射关系。

### 技术架构
<p align="center">
  <img src="https://github.com/user-attachments/assets/e645abf5-3b0f-43d4-9363-d1ca7be84b45" width="70%">
</p>

PID对外提供在线RPC接口和离线acache两种交互方式。

数据建设模块负责生产底层的映射数据，对外返回结果的业务逻辑分别由在线模块和离线模块实现。

#### 数据建设模块
- **实时处理**  
  将实时数据流进行解析、清洗和格式化后，实时增量写入存储中。
- **离线处理**  
  对历史数据进行解析、清洗和格式化后，全量写入存储中。

#### 在线模块
- **召回策略**  
  支持业务方采用不同的召回口径（比如：同款相似度阈值、特征类型等）。
- **过滤策略**  
  支持业务方配置想要的过滤方法（比如：同款个数等）。

### 应用方向

#### 电商序列特征
组内在进行很多电商相关业务，和电商团队合作密切。闭环电商序列构建，非闭环同款特征获取都会走这个服务。

1. **电商序列构建**  
   电商序列保存了每位用户点击过的商品。在存储商品的过程中，会访问pid-center，获取商品属性。  

   技术指标：每天访问量级为QPS ～10W，存储量级为2T(开销在于保存半年数据)。

3. **非闭环同款特征补充**  
   非闭环因站外商品特征缺失，会通过站内同款补充特征。模型实时训练会访问pid-center，获取商品属性。

#### 频控
电商场景存在大量多平台经营的情况，即一类商家会将相似的产品在抖音、淘宝和京东等多个电商平台售卖。需要有频控方案，解决用户视角下的重复体验case，降低重复反馈。

**频控链路**  
<p align="center">
  <img src="https://github.com/user-attachments/assets/fcbe7b21-b6aa-4179-bc7b-cb46db0f1a72" width="70%">
</p>

##### 技术方案
kati builder调用pid center，通过站外adId获取站外商品 - 站内同款商品，用于后续频控链路生效。

##### 技术指标
存储指标：pid映射关系存储量级，4GB(20天 且只记录string)。

流量指标：每天访问量级为QPS ～2K

附：一次广告请求的全流程。
<p align="center">
  <img src="https://github.com/user-attachments/assets/3701bed7-4986-47fe-b253-4102d50b2635" width="70%">
</p>
